@model Barabas.Models.Event

@{
    ViewData["Title"] = Model.Name;
}

<div class="container py-5">
    <div class="card event-card shadow-lg border-0 rounded-4 overflow-hidden">
        <div class="row g-0">
            <div class="col-md-5 position-relative">
                <img src="@Model.Image" alt="@Model.Name" class="img-fluid h-100 w-100 object-fit-cover" style="max-height: 500px;">
                <div class="event-date-badge text-white fw-semibold">
                    <span>@Model.Date.ToString("dd MMM")</span><br>
                    <small>@Model.Date.ToString("yyyy")</small>
                </div>
            </div>

            <div class="col-md-7 p-4 p-lg-5 d-flex flex-column justify-content-between bg-white">
                <div>
                    <h1 class="fw-bold mb-3 text-primary">@Model.Name</h1>

                    <div class="d-flex flex-wrap align-items-center mb-3 gap-2">
                        <span class="info-badge">
                            📅 @Model.Date.ToString("dd MMMM yyyy, HH:mm")
                        </span>
                        <span class="info-badge">
                            📍 @Model.Location
                        </span>
                    </div>

                    <h4 class="fw-semibold text-success mb-4">
                        💰 <span>@Model.Price.ToString("0.00") ₴</span>
                    </h4>

                    <div class="description-box mb-4">
                        <p class="text-secondary lh-base">@Model.Description</p>
                    </div>
                </div>

                <div class="d-flex flex-column flex-md-row align-items-center gap-3 mt-3">
                    <a href="@Url.Action("SelectTickets", "Orders", new { eventId = Model.Id })"
                       class="btn btn-gradient btn-lg rounded-pill px-5 shadow-sm">
                        🎫 Buy Tickets
                    </a>

                    @if (!(ViewBag.IsGoing ?? false))
                    {
                        <form asp-action="ImGoing" method="post" class="d-inline">
                            <input type="hidden" name="eventId" value="@Model.Id" />
                            <button type="submit" class="btn btn-success btn-lg rounded-pill px-5 shadow-sm">
                                ✅ I'm Going
                            </button>
                        </form>
                    }
                    else
                    {
                        <div class="alert alert-success rounded-pill px-4 py-2 mt-2 text-center mb-0">
                            🎉 You’re already going!
                        </div>
                    }

                    <a href="@Url.Action("Index", "Home")"
                       class="btn btn-outline-secondary btn-lg rounded-pill px-5 shadow-sm">
                        ← Back
                    </a>
                </div>

                <div class="mt-5 attendees-box p-3 rounded-4">
                    <h5 class="fw-semibold text-secondary mb-3">👥 People attending this event:</h5>
                    <ul id="attendeesList" class="list-unstyled text-secondary small mb-0"></ul>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const eventId = @Model.Id;
            const response = await fetch(`/Events/WhoIsGoing?eventId=${eventId}`);
            const attendees = await response.json();
            const list = document.getElementById("attendeesList");

            if (attendees.length === 0) {
                list.innerHTML = "<li class='text-muted'>No one has joined yet 😔</li>";
            } else {
                attendees.forEach(name => {
                    const li = document.createElement("li");
                    li.classList.add("attendee-item");
                    li.innerHTML = `<span class="attendee-avatar">👤</span> <strong>${name}</strong>`;
                    list.appendChild(li);
                });
            }
        });
    </script>
}

<style>
    body {
        background-color: #f8f9fb;
    }

    .event-card {
        transition: box-shadow 0.3s ease, transform 0.3s ease;
    }

        .event-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

    .object-fit-cover {
        object-fit: cover;
    }

    .event-date-badge {
        position: absolute;
        bottom: 20px;
        left: 20px;
        background: rgba(0, 123, 255, 0.9);
        padding: 10px 15px;
        border-radius: 10px;
        text-align: center;
        font-size: 1.1rem;
    }

    .info-badge {
        background-color: #eef3fa;
        color: #3a3a3a;
        border-radius: 30px;
        padding: 8px 15px;
        font-size: 0.95rem;
        font-weight: 500;
    }

    .description-box {
        background-color: #f9fafc;
        border-radius: 12px;
        padding: 15px;
        max-height: 200px;
        overflow-y: auto;
    }

    .btn-gradient {
        background: linear-gradient(90deg, #007bff 0%, #0056d6 100%);
        color: white;
        border: none;
        transition: all 0.3s ease;
    }

        .btn-gradient:hover {
            transform: scale(1.03);
            background: linear-gradient(90deg, #0056d6 0%, #0040a8 100%);
        }

    .attendees-box {
        background-color: #f5f9ff;
        border: 1px solid #dee2e6;
    }

    .attendee-item {
        padding: 6px 0;
        border-bottom: 1px solid #e9ecef;
    }

        .attendee-item:last-child {
            border-bottom: none;
        }

    .attendee-avatar {
        font-size: 1.1rem;
        margin-right: 6px;
    }
</style>
